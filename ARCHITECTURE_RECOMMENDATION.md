# 시스템 아키텍처 최적 구성 가이드

현재 프로젝트 규모와 요구사항을 고려한 최적의 Railway 배포 구성을 제안합니다.

---

## 🎯 현재 시스템 분석

### 현재 구조
- **백엔드**: Flask (Python)
- **프론트엔드**: Flask 템플릿 (서버 사이드 렌더링)
- **클라이언트**: main.py (골프 컴퓨터에서 실행)
- **데이터베이스**: PostgreSQL
- **역할**: 매장(관리자) / 유저

### API 엔드포인트
- `/api/save_shot` - 샷 데이터 저장
- `/api/active_user` - 활성 사용자 조회
- `/api/clear_session` - 세션 삭제

### 웹 페이지
- 사용자: 로그인, 회원가입, 메인, 샷 기록
- 관리자: 로그인, 대시보드, 샷 기록 관리

---

## 💡 최적 구성 제안

### 옵션 1: 단일 웹 서비스 (권장 - 현재 규모)

**구조:**
```
Railway 프로젝트
├── 웹 서비스 1개 (Flask 앱)
│   ├── 백엔드 API
│   ├── 프론트엔드 (템플릿)
│   └── 매장/유저 라우팅
└── PostgreSQL
```

**장점:**
- ✅ 간단한 배포 및 관리
- ✅ 낮은 비용 (서비스 1개)
- ✅ 빠른 개발 및 배포
- ✅ 현재 프로젝트 규모에 적합

**단점:**
- ⚠️ 프론트엔드/백엔드 분리 불가
- ⚠️ 확장성 제한

**권장 시나리오:**
- 초기 단계
- 사용자 수가 적을 때 (수십 명)
- 빠른 프로토타입

---

### 옵션 2: 프론트엔드/백엔드 분리 (중규모)

**구조:**
```
Railway 프로젝트
├── 백엔드 서비스 (Flask API만)
│   └── /api/* 엔드포인트
├── 프론트엔드 서비스 (정적 파일 또는 React/Vue)
│   └── 사용자/관리자 UI
└── PostgreSQL
```

**장점:**
- ✅ 프론트엔드/백엔드 독립 배포
- ✅ 프론트엔드 CDN 활용 가능
- ✅ 확장성 향상

**단점:**
- ⚠️ 복잡도 증가
- ⚠️ 비용 증가 (서비스 2개)
- ⚠️ CORS 설정 필요

**권장 시나리오:**
- 사용자 수 증가 (수백 명)
- 모바일 앱 추가 예정
- 프론트엔드 팀 분리

---

### 옵션 3: 매장/유저 서비스 분리 (대규모)

**구조:**
```
Railway 프로젝트
├── 유저 서비스 (Flask)
│   ├── 유저 API
│   └── 유저 프론트엔드
├── 매장 서비스 (Flask)
│   ├── 매장 API
│   └── 관리자 프론트엔드
├── 공통 API 서비스 (선택사항)
│   └── 공통 로직
└── PostgreSQL
```

**장점:**
- ✅ 역할별 독립 배포
- ✅ 권한 관리 용이
- ✅ 확장성 최대

**단점:**
- ⚠️ 복잡도 매우 높음
- ⚠️ 비용 증가 (서비스 2-3개)
- ⚠️ 코드 중복 가능성

**권장 시나리오:**
- 사용자 수 많음 (수천 명)
- 매장 수 많음 (수십 개)
- 팀 규모 큼

---

## 🎯 현재 프로젝트에 대한 권장사항

### 단계별 접근 (권장)

#### 1단계: 현재 - 단일 웹 서비스
```
웹 서비스 1개 + PostgreSQL
```
- 현재 구조 유지
- 빠른 배포 및 운영
- 비용 효율적

#### 2단계: 성장 시 - 프론트엔드 분리
```
백엔드 서비스 + 프론트엔드 서비스 + PostgreSQL
```
- 사용자 증가 시
- 모바일 앱 추가 시

#### 3단계: 확장 시 - 역할별 분리
```
유저 서비스 + 매장 서비스 + PostgreSQL
```
- 대규모 확장 시
- 팀 규모 증가 시

---

## 📊 비교표

| 구성 | 서비스 수 | 복잡도 | 비용 | 확장성 | 권장 규모 |
|------|----------|--------|------|--------|-----------|
| 단일 서비스 | 1 | 낮음 | 낮음 | 낮음 | 초기 (수십 명) |
| 프론트/백엔드 분리 | 2 | 중간 | 중간 | 중간 | 중규모 (수백 명) |
| 역할별 분리 | 2-3 | 높음 | 높음 | 높음 | 대규모 (수천 명) |

---

## 🚀 즉시 적용 가능한 최적 구성

### 현재 단계: 단일 웹 서비스 (권장)

**Railway 구성:**
```
golf_trainer 프로젝트
├── 웹 서비스 (Flask)
│   ├── app.py (백엔드 + 프론트엔드)
│   ├── /api/* (API 엔드포인트)
│   ├── /user/* (유저 페이지)
│   ├── /admin/* (관리자 페이지)
│   └── templates/ (프론트엔드)
└── PostgreSQL
```

**라우팅 구조:**
- `/` - 홈/로그인
- `/user/*` - 유저 관련
- `/admin/*` - 관리자 관련
- `/api/*` - API 엔드포인트

**장점:**
- ✅ 현재 코드 구조 그대로 사용
- ✅ 추가 개발 불필요
- ✅ 즉시 배포 가능
- ✅ 비용 효율적

---

## 🔧 코드 구조 개선 (단일 서비스 내)

현재 단일 서비스를 유지하되, 코드 구조를 개선할 수 있습니다:

### 디렉토리 구조
```
golf_trainer/
├── app.py (메인 앱)
├── routes/
│   ├── user_routes.py (유저 라우팅)
│   ├── admin_routes.py (관리자 라우팅)
│   └── api_routes.py (API 라우팅)
├── templates/
│   ├── user/ (유저 템플릿)
│   └── admin/ (관리자 템플릿)
└── static/ (정적 파일)
```

### 라우팅 분리 예시
```python
# routes/user_routes.py
from flask import Blueprint
user_bp = Blueprint('user', __name__, url_prefix='/user')

@user_bp.route('/main')
def user_main():
    ...

# routes/admin_routes.py
from flask import Blueprint
admin_bp = Blueprint('admin', __name__, url_prefix='/admin')

@admin_bp.route('/')
def admin_dashboard():
    ...

# app.py
from routes.user_routes import user_bp
from routes.admin_routes import admin_bp
app.register_blueprint(user_bp)
app.register_blueprint(admin_bp)
```

---

## 📝 결론 및 권장사항

### 현재 단계: 단일 웹 서비스 사용 (권장)

**이유:**
1. ✅ 프로젝트 규모에 적합
2. ✅ 빠른 배포 및 운영
3. ✅ 비용 효율적
4. ✅ 유지보수 용이
5. ✅ 현재 코드 구조 그대로 사용 가능

**Railway 구성:**
- 웹 서비스 1개 (Flask 앱)
- PostgreSQL 1개

**향후 확장:**
- 사용자 증가 시 프론트엔드 분리 고려
- 대규모 확장 시 역할별 분리 고려

---

## 🎯 다음 단계

1. **현재**: 단일 웹 서비스로 배포
2. **모니터링**: 사용자 수, 트래픽 모니터링
3. **확장 결정**: 필요 시 프론트엔드 분리 또는 역할별 분리

---

## 💡 추가 고려사항

### 성능 최적화 (단일 서비스 내)
- 정적 파일 CDN 사용
- 캐싱 전략
- 데이터베이스 인덱싱

### 보안 강화
- 역할별 라우팅 분리 (코드 레벨)
- 권한 미들웨어
- API 인증 강화

### 모니터링
- Railway 메트릭 활용
- 로그 분석
- 성능 모니터링
