# 실제 운영 환경 설정 가이드

## 개요
- **PC (현재 컴퓨터)**: 매장 등록, PC 등록, 샷 수집 프로그램 실행
- **핸드폰**: 유저 로그인 및 타석 선택

## 1단계: Railway 서비스 URL 확인

### 필요한 서비스 URL
1. **API 서비스**: `https://golf-api-production-e675.up.railway.app`
2. **유저 웹 서비스**: Railway에서 확인 필요 (예: `https://golf-user-web-production-*.up.railway.app`)
3. **매장 관리자 서비스**: Railway에서 확인 필요
4. **슈퍼 관리자 서비스**: Railway에서 확인 필요

### Railway에서 URL 확인 방법
1. Railway 대시보드 접속
2. 각 서비스의 "Settings" → "Domains" 또는 "Deployments"에서 Public URL 확인

## 2단계: PC 등록 프로그램 설정

### `register_pc_gui.py` 서버 URL 확인
현재 기본값: `https://golf-api-production-e675.up.railway.app`

필요시 수정:
```python
DEFAULT_SERVER_URL = os.environ.get("SERVER_URL", "https://golf-api-production-e675.up.railway.app")
```

## 3단계: 매장 등록

### 방법 1: 매장 관리자 가입 페이지 사용
1. 매장 관리자 서비스 URL 접속
2. "매장 가입" 클릭
3. 정보 입력:
   - 매장 아이디: `TESTID` (또는 원하는 ID)
   - 매장명: `테스트매장` (또는 원하는 이름)
   - 비밀번호: (설정)
   - 전체 타석(룸) 수: `1` (또는 원하는 수)
   - 기타 정보 입력
4. 가입 완료 → 슈퍼 관리자 승인 대기

### 방법 2: 슈퍼 관리자로 직접 등록
1. 슈퍼 관리자 서비스 접속
2. "매장 관리" → "매장 등록 요청" 확인
3. 승인 또는 직접 등록

## 4단계: PC 등록

### PC 등록 프로그램 실행
1. `register_pc_gui.exe` 실행
2. **PC 등록 코드** 입력:
   - 슈퍼 관리자 페이지에서 생성한 등록 코드 사용
   - 또는 기존 등록 코드 확인
3. **매장아이디** 입력: `TESTID` (2단계에서 등록한 매장 ID)
4. "조회" 클릭 → 매장 정보 확인
5. "확인" 클릭
6. **타석번호** 입력: `1번룸` (또는 `01번 타석`)
7. "등록 요청" 클릭
8. 등록 완료 → 슈퍼 관리자 승인 대기

### 슈퍼 관리자 승인
1. 슈퍼 관리자 서비스 접속
2. "PC 관리" (또는 "타석(룸) 관리") 메뉴
3. 등록 요청된 PC 확인
4. "승인" 클릭
5. 사용 기간 설정 (필요시)

## 5단계: 샷 수집 프로그램 설정

### `config/config.json` 파일 생성/수정
샷 수집 프로그램(`GolfShotTracker.exe`)과 같은 폴더에 `config` 폴더 생성 후 `config.json` 파일 생성:

```json
{
  "auto_brand": "sg골프",
  "auto_filename": "sg골프 v3",
  "store_id": "TESTID",
  "bay_id": "01",
  "API_BASE_URL": "https://golf-api-production-e675.up.railway.app"
}
```

**설명**:
- `auto_brand`: 좌표 파일 브랜드 (예: "sg골프", "골프존" 등)
- `auto_filename`: 좌표 파일명 (예: "sg골프 v3", "골프존 v2" 등)
- `store_id`: 매장 ID (3단계에서 등록한 매장 ID)
- `bay_id`: 타석 번호 (4단계에서 등록한 타석 번호, "01" 형식)
- `API_BASE_URL`: API 서비스 URL (기본값 사용 가능)

### 좌표 파일 확인
1. 좌표 캘리브레이션 프로그램(`calibrate_regions_gui.exe`) 실행
2. 브랜드 선택: `sg골프`
3. 좌표 설정 완료 후 서버에 업로드
4. 파일명 확인: `sg골프 v3` (또는 설정한 파일명)

## 6단계: 샷 수집 프로그램 실행

### 자동 시작 설정 (선택사항)
1. `setup_autostart.bat` 실행
2. Windows 시작 프로그램에 등록됨
3. PC 재부팅 시 자동 실행

### 수동 실행
1. `GolfShotTracker.exe` 실행
2. 프로그램이 `config.json`을 읽어서 자동 시작
3. 시스템 트레이에 아이콘 표시
4. 트레이 아이콘 우클릭 → "GUI 열기" (필요시)

## 7단계: 유저 계정 생성 (핸드폰)

### 유저 서비스 접속
1. 핸드폰 브라우저에서 유저 서비스 URL 접속
   - 예: `https://golf-user-web-production-*.up.railway.app`
2. "회원가입" 클릭

### 회원가입 정보 입력
- 이름: (본인 이름)
- 휴대폰번호: (본인 번호, 이게 user_id가 됨)
- 생년월일: (YYYY-MM-DD 형식)
- 성별: 남/여 선택
- 비밀번호: (설정)

### 회원가입 완료
- 로그인 페이지로 자동 이동

## 8단계: 유저 로그인 및 타석 선택 (핸드폰)

### 로그인
1. 유저 서비스 로그인 페이지
2. 휴대폰번호 (user_id) 입력
3. 비밀번호 입력
4. "로그인" 클릭

### 매장/타석 선택
1. 자동으로 매장/타석 선택 페이지로 이동
2. **매장 선택**: `TESTID` (또는 등록한 매장)
3. **타석 선택**: `01번 타석` (또는 등록한 타석)
4. "확인" 클릭
5. → 활성 세션이 등록됨

## 9단계: 샷 데이터 기록 테스트

### 샷 수집 확인
1. PC에서 샷 수집 프로그램 실행 중 확인
2. 골프 게임에서 샷 실행
3. 샷 수집 프로그램 로그 확인:
   - `👤 현재 활성 사용자: [휴대폰번호]` 메시지 확인
   - `[SHOT CONFIRMED]` 메시지 확인
   - `✅ 서버 전송 성공` 메시지 확인

### 샷 데이터 확인
1. **매장 관리자 페이지**:
   - 매장 관리자 서비스 접속
   - `TESTID` 로그인
   - "01번 타석" → "샷 기록 보기"
   - 유저의 샷 데이터 확인

2. **유저 페이지** (핸드폰):
   - 유저 로그인 상태
   - "전체 샷 기록 보기"
   - `TESTID` 매장 `01번 타석`의 샷 데이터 확인

## 문제 해결

### 문제 1: PC 등록 코드가 없음
**해결**: 슈퍼 관리자 페이지에서 등록 코드 생성
1. 슈퍼 관리자 서비스 접속
2. "등록 코드 관리" 또는 관련 메뉴
3. 새 등록 코드 생성

### 문제 2: 샷이 게스트로 저장됨
**원인**: 활성 세션이 없거나 `store_id`/`bay_id` 불일치

**해결**:
1. 유저가 정확히 매장/타석을 선택했는지 확인
2. `config.json`의 `store_id`와 `bay_id` 확인
3. 샷 수집 프로그램 로그에서 `👤 현재 활성 사용자:` 메시지 확인

### 문제 3: 좌표 파일을 찾을 수 없음
**해결**:
1. 좌표 캘리브레이션 프로그램으로 좌표 설정
2. 서버에 업로드 확인
3. `config.json`의 `auto_brand`와 `auto_filename` 확인

### 문제 4: API 연결 실패
**해결**:
1. `config.json`의 `API_BASE_URL` 확인
2. Railway 서비스가 정상 실행 중인지 확인
3. 샷 수집 프로그램 로그에서 오류 메시지 확인

## 체크리스트

### PC 설정
- [ ] 매장 등록 완료
- [ ] PC 등록 완료
- [ ] 슈퍼 관리자 승인 완료
- [ ] `config/config.json` 파일 생성 및 설정
- [ ] 좌표 파일 서버 업로드 완료
- [ ] 샷 수집 프로그램 실행 중

### 핸드폰 설정
- [ ] 유저 계정 생성 완료
- [ ] 유저 로그인 성공
- [ ] 매장/타석 선택 완료
- [ ] 활성 세션 등록 확인

### 테스트
- [ ] 샷 수집 프로그램에서 활성 사용자 조회 성공
- [ ] 샷 감지 및 서버 전송 성공
- [ ] 매장 관리자 페이지에서 샷 데이터 확인
- [ ] 유저 페이지에서 샷 데이터 확인
