<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ì±…ì„ì ëŒ€ì‹œë³´ë“œ - Golf Trainer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/super_admin.css') }}?v=2.0">
</head>
<body>
    <div class="super-container">
        <div class="super-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="text-white mb-0">ğŸ‘‘ ì´ì±…ì„ì ëŒ€ì‹œë³´ë“œ</h1>
                    <span class="badge bg-danger">ìŠˆí¼ ê´€ë¦¬ì</span>
                </div>
                <div class="d-flex gap-2 align-items-center">
                    {% if emergency_mode %}
                    <div class="alert alert-danger mb-0 py-1 px-2" style="font-size: 0.9rem;">
                        <strong>ğŸš¨ Emergency Mode ON</strong>
                    </div>
                    {% endif %}
                    <button id="emergency-toggle" class="super-btn {{ 'super-btn-danger' if emergency_mode else 'super-btn-warning' }}" 
                            onclick="toggleEmergency()">
                        {{ 'Emergency OFF' if emergency_mode else 'Emergency ON' }}
                    </button>
                    <a href="{{ url_for('super_admin_logout') }}" class="super-btn super-btn-primary">ë¡œê·¸ì•„ì›ƒ</a>
                </div>
            </div>
        </div>
        
        <div class="super-main-content">
            <!-- í†µê³„ ì¹´ë“œ -->
            <div class="super-stats-grid">
                <div class="super-stat-card">
                    <div class="super-stat-label">ì „ì²´ ë§¤ì¥</div>
                    <div class="super-stat-value">{{ stats.total_stores }}</div>
                </div>
                <div class="super-stat-card">
                    <div class="super-stat-label">í™œì„± ë§¤ì¥</div>
                    <div class="super-stat-value">{{ stats.active_stores }}</div>
                </div>
                <div class="super-stat-card">
                    <div class="super-stat-label">ë§Œë£Œ ë§¤ì¥</div>
                    <div class="super-stat-value">{{ stats.expired_stores }}</div>
                </div>
            </div>
            
            <!-- ë©”ë‰´ -->
            <div class="d-flex gap-2 mb-4">
                <a href="{{ url_for('store_requests') }}" class="super-btn super-btn-warning">
                    ğŸ“‹ ë§¤ì¥ ë“±ë¡ ìš”ì²­
                    {% set pending_count = stores|selectattr('status', 'equalto', 'pending')|list|length %}
                    {% if pending_count > 0 %}
                    <span class="badge bg-danger">{{ pending_count }}</span>
                    {% endif %}
                </a>
                <a href="{{ url_for('manage_stores') }}" class="super-btn super-btn-primary">ë§¤ì¥ ê´€ë¦¬</a>
                <a href="{{ url_for('manage_payments') }}" class="super-btn super-btn-primary">ê²°ì œ ê´€ë¦¬</a>
                <a href="{{ url_for('manage_subscriptions') }}" class="super-btn super-btn-primary">ì‚¬ìš©ê¸°ê°„ ê´€ë¦¬</a>
                <a href="{{ url_for('manage_all_pcs') }}" class="super-btn super-btn-primary">íƒ€ì„(ë£¸) ê´€ë¦¬</a>
            </div>
            
            <!-- ë§¤ì¥ ëª©ë¡ -->
            <h4 class="mb-3">ë§¤ì¥ ëª©ë¡</h4>
            <div class="super-store-grid">
                {% for store in stores %}
                <div class="super-store-card">
                    <div class="super-store-header">
                        <div class="super-store-name">{{ store.store_name or store.store_id }}</div>
                        <div class="super-store-status {{ store.subscription_status or 'active' }}">
                            {{ 'í™œì„±' if (store.subscription_status or 'active') == 'active' else 'ë§Œë£Œ' }}
                        </div>
                    </div>
                    <div class="super-store-info">
                        <div>ë§¤ì¥ ì½”ë“œ: <strong>{{ store.store_id }}</strong></div>
                        <div>ì´ íƒ€ì„ìˆ˜: {{ store.valid_bays_count }}/{{ store.total_bays_count }}</div>
                        {% if store.subscription_end_date %}
                        <div>ì‚¬ìš©ê¸°ê°„: {{ store.subscription_end_date }}ê¹Œì§€</div>
                        {% endif %}
                    </div>
                    <div class="mt-2">
                        <button class="super-btn super-btn-success btn-sm" 
                                onclick="extendSubscription('{{ store.store_id }}', 1)">
                            1ê°œì›” ì—°ì¥
                        </button>
                        <button class="super-btn super-btn-success btn-sm" 
                                onclick="extendSubscription('{{ store.store_id }}', 3)">
                            3ê°œì›” ì—°ì¥
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- Emergency ëª¨ë“œ ê²½ê³  ëª¨ë‹¬ -->
    <div class="modal fade" id="emergencyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">âš ï¸ Emergency ëª¨ë“œ í™œì„±í™”</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <strong>ì´ ê¸°ëŠ¥ì€ ì¥ì•  ëŒ€ì‘ìš©ì…ë‹ˆë‹¤.</strong><br>
                        Emergency ëª¨ë“œì—ì„œëŠ” ì§ì ‘ ìˆ˜ì •ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ëª¨ë“  ì‘ì—…ì€ ê¸°ë¡ë©ë‹ˆë‹¤.
                    </div>
                    <p>Emergency ëª¨ë“œë¥¼ í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-danger" onclick="confirmEmergency()">Emergency ëª¨ë“œ í™œì„±í™”</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleEmergency() {
            {% if emergency_mode %}
            // Emergency OFF
            if (confirm('Emergency ëª¨ë“œë¥¼ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ìˆ˜ì • ê¸°ëŠ¥ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤.')) {
                fetch('{{ url_for("toggle_emergency") }}', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    }
                });
            }
            {% else %}
            // Emergency ON - ê²½ê³  ëª¨ë‹¬ í‘œì‹œ
            new bootstrap.Modal(document.getElementById('emergencyModal')).show();
            {% endif %}
        }
        
        function confirmEmergency() {
            bootstrap.Modal.getInstance(document.getElementById('emergencyModal')).hide();
            fetch('{{ url_for("toggle_emergency") }}', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Emergency ëª¨ë“œ ì „í™˜ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            })
            .catch(error => {
                alert('Emergency ëª¨ë“œ ì „í™˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error);
            });
        }
        
        function extendSubscription(storeId, months) {
            if (confirm(`${months}ê°œì›” êµ¬ë…ì„ ì—°ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                fetch('{{ url_for("extend_subscription") }}', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({store_id: storeId, months: months})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`êµ¬ë…ì´ ${data.new_end_date}ê¹Œì§€ ì—°ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        location.reload();
                    }
                });
            }
        }
    </script>
</body>
</html>
