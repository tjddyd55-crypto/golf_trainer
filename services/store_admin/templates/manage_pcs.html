<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§¤ì¥ íƒ€ì„(ë£¸) ê´€ë¦¬ - {{ store_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/store_admin.css') }}">
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1 class="text-white mb-0">ğŸ¢ ë§¤ì¥ íƒ€ì„(ë£¸) ê´€ë¦¬ - {{ store_name }}</h1>
        </div>
        
        <div class="admin-main-content">
            <div class="mb-3">
                <a href="{{ url_for('store_admin_dashboard') }}" class="admin-btn admin-btn-secondary">â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
            </div>
            
            <div class="alert alert-info">
                <strong>íƒ€ì„(ë£¸) ë“±ë¡ ë°©ë²•:</strong><br>
                1. ê° íƒ€ì„(ë£¸)ì˜ ì»´í“¨í„°ì—ì„œ <code>register_pc.py</code> ì‹¤í–‰<br>
                2. ë§¤ì¥ëª…, íƒ€ì„(ë£¸)ëª…, íƒ€ì„(ë£¸) ì´ë¦„ ì…ë ¥ (ì˜ˆ: 1ë²ˆë°©, 1ë²ˆë£¸)<br>
                3. ì„œë²„ì— ìë™ ë“±ë¡
            </div>
            
            {% if pcs %}
            <div class="table-responsive">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>íƒ€ì„(ë£¸)ë²ˆí˜¸</th>
                            <th>íƒ€ì„(ë£¸) ì´ë¦„</th>
                            <th>ë“±ë¡ì¼</th>
                            <th>ì‚¬ìš©ê¸°ê°„</th>
                            <th>ë§ˆì§€ë§‰ ì ‘ì†</th>
                            <th>ìƒíƒœ</th>
                            <th>ìƒì„¸ì •ë³´</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pc in pcs %}
                        <tr>
                            <td><strong style="font-size: 1.1em; color: #007bff;">{{ pc.pc_name or pc.bay_display }}</strong></td>
                            <td>{{ pc.registered_at.split(' ')[0] if pc.registered_at else "-" }}</td>
                            <td>
                                {% if pc.usage_start_date and pc.usage_end_date %}
                                    {{ pc.usage_start_date }} ~ {{ pc.usage_end_date }}
                                {% elif pc.usage_end_date %}
                                    ~ {{ pc.usage_end_date }}
                                {% else %}
                                    <span class="text-muted">ë¯¸ì„¤ì •</span>
                                {% endif %}
                            </td>
                            <td>{{ pc.last_seen_at.split(' ')[0] if pc.last_seen_at else "-" }}</td>
                            <td>
                                <span class="badge {{ 'bg-success' if pc.status == 'active' else 'bg-warning' if pc.status == 'pending' else 'bg-danger' }}">
                                    {% if pc.status == 'pending' %}ëŒ€ê¸°
                                    {% elif pc.status == 'active' %}í™œì„±
                                    {% elif pc.status == 'rejected' %}ê±°ë¶€
                                    {% else %}{{ pc.status or 'ëŒ€ê¸°' }}
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-secondary" onclick="showDetailModal('{{ pc.pc_unique_id }}', '{{ pc.bay_display }}', '{{ pc.pc_name }}', '{{ pc.pc_hostname or '' }}', '{{ pc.pc_platform or '' }}', '{{ pc.registered_at or '' }}', '{{ pc.approved_at or '' }}', '{{ pc.usage_start_date or '' }}', '{{ pc.usage_end_date or '' }}')">ìƒì„¸</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-warning">
                ë“±ë¡ëœ íƒ€ì„(ë£¸)ì´ ì—†ìŠµë‹ˆë‹¤. ê° íƒ€ì„(ë£¸)ì˜ ì»´í“¨í„°ì—ì„œ <code>register_pc.py</code>ë¥¼ ì‹¤í–‰í•˜ì—¬ ë“±ë¡í•˜ì„¸ìš”.
            </div>
            {% endif %}
        </div>
    </div>

    <!-- ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">PC ìƒì„¸ ì •ë³´</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-bordered">
                        <tr>
                            <th width="30%">íƒ€ì„(ë£¸) ì´ë¦„</th>
                            <td id="detail-pc-name"></td>
                        </tr>
                        <tr>
                            <th>í˜¸ìŠ¤íŠ¸ëª…</th>
                            <td id="detail-hostname"></td>
                        </tr>
                        <tr>
                            <th>í”Œë«í¼</th>
                            <td id="detail-platform"></td>
                        </tr>
                        <tr>
                            <th>PC ê³ ìœ ë²ˆí˜¸</th>
                            <td><code id="detail-unique-id" style="font-size: 0.85rem; word-break: break-all;"></code></td>
                        </tr>
                        <tr>
                            <th>ë“±ë¡ì¼</th>
                            <td id="detail-registered-at"></td>
                        </tr>
                        <tr>
                            <th>ìŠ¹ì¸ì¼</th>
                            <td id="detail-approved-at"></td>
                        </tr>
                        <tr>
                            <th>ì‚¬ìš©ê¸°ê°„</th>
                            <td id="detail-usage-period"></td>
                        </tr>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showDetailModal(pcUniqueId, bayName, pcName, hostname, platform, registeredAt, approvedAt, usageStartDate, usageEndDate) {
            document.getElementById('detail-pc-name').textContent = pcName || bayName || '-';
            document.getElementById('detail-hostname').textContent = hostname || '-';
            document.getElementById('detail-platform').textContent = platform || '-';
            document.getElementById('detail-unique-id').textContent = pcUniqueId || '-';
            document.getElementById('detail-registered-at').textContent = registeredAt ? registeredAt.split(' ')[0] : '-';
            document.getElementById('detail-approved-at').textContent = approvedAt ? approvedAt.split(' ')[0] : '-';
            
            let usagePeriod = '-';
            if (usageStartDate && usageEndDate) {
                usagePeriod = usageStartDate + ' ~ ' + usageEndDate;
            } else if (usageEndDate) {
                usagePeriod = '~ ' + usageEndDate;
            }
            document.getElementById('detail-usage-period').textContent = usagePeriod;
            
            new bootstrap.Modal(document.getElementById('detailModal')).show();
        }
    </script>
</body>
</html>
