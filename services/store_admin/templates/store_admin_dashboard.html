<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§¤ì¥ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - {{ store_id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/store_admin.css') }}">
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="text-white mb-0">â›³ {{ store_id }} ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <a href="{{ url_for('store_admin_logout') }}" class="admin-btn admin-btn-danger">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
        
        {% if readonly_mode %}
        <div class="alert alert-warning m-3" role="alert">
            <h5 class="alert-heading">âš ï¸ ì½ê¸° ì „ìš© ëª¨ë“œ</h5>
            {% if readonly_reason == "no_valid_pc" %}
            <p>ìœ íš¨í•œ íƒ€ì„ì´ ì—†ìŠµë‹ˆë‹¤. PCë¥¼ ë“±ë¡í•˜ê±°ë‚˜ ì‚¬ìš© ê¸°ê°„ì„ ì—°ì¥í•´ì£¼ì„¸ìš”.</p>
            {% elif readonly_reason == "no_pc" %}
            <p>ë“±ë¡ëœ íƒ€ì„ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € PCë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>
            {% endif %}
            <hr>
            <p class="mb-0">ì´ ëª¨ë“œì—ì„œëŠ” ìƒ· ë°ì´í„° ì¡°íšŒ, í†µê³„, ë³´ê³ ì„œ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.</p>
        </div>
        {% endif %}
        
        <div class="admin-main-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4>ğŸ–¥ï¸ íƒ€ì„ í˜„í™©</h4>
                <div>
                    <a href="{{ url_for('manage_pcs') }}" class="admin-btn admin-btn-primary me-2">PC ê´€ë¦¬</a>
                    <button class="admin-btn admin-btn-danger" onclick="clearAllSessions()">ëª¨ë“  ì„¸ì…˜ ì‚­ì œ</button>
                </div>
            </div>
            
            <div class="admin-bay-grid">
                {% for bay in bays %}
                <div class="admin-bay-card {{ 'active' if bay.active_user else '' }}">
                    <div class="admin-bay-card-header">
                        <div class="admin-bay-number">{{ bay.bay_id }}ë²ˆ íƒ€ì„</div>
                        <div class="admin-bay-status {{ 'active' if bay.active_user else 'ready' }}">
                            {{ 'ë¡œê·¸ì¸ ì¤‘' if bay.active_user else 'ë¹„ì–´ ìˆìŒ' }}
                        </div>
                    </div>
                    
                    {% if bay.bay_code %}
                    <div class="admin-bay-code">{{ bay.bay_code }}</div>
                    {% endif %}
                    
                    {% if bay.active_user %}
                    <div class="mt-2">
                        <strong>{{ bay.active_user }} ë‹˜</strong><br>
                        <small class="text-muted">ë¡œê·¸ì¸: {{ bay.login_time.split(' ')[1] if bay.login_time else '' }}</small>
                        <br>
                        <button class="admin-btn admin-btn-danger btn-sm mt-2" 
                                onclick="clearSession('{{ store_id }}', '{{ bay.bay_id }}')">
                            ì„¸ì…˜ ì‚­ì œ
                        </button>
                    </div>
                    {% else %}
                    <div class="mt-2 text-muted">ëŒ€ê¸° ì¤‘...</div>
                    {% endif %}
                    
                    <div class="mt-2">
                        <a href="{{ url_for('bay_shots', store_id=store_id, bay_id=bay.bay_id) }}" 
                           class="admin-btn admin-btn-primary btn-sm">
                            ìƒ· ê¸°ë¡ ë³´ê¸°
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div class="mt-4">
                <h4>ğŸ“Š ì „ì²´ ìƒ· ê¸°ë¡</h4>
                {% if shots %}
                <div class="table-responsive">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ì‹œê°„</th>
                                <th>íƒ€ì„</th>
                                <th>ì‚¬ìš©ì</th>
                                <th>í´ëŸ½</th>
                                <th>ì´ê±°ë¦¬</th>
                                <th>ìºë¦¬</th>
                                <th>ìŠ¤ë§¤ì‹œíŒ©í„°</th>
                                <th>ë³¼ìŠ¤í”¼ë“œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for s in shots[:20] %}
                            <tr>
                                <td>{{ s.timestamp.split(' ')[1] if s.timestamp else "" }}</td>
                                <td>{{ s.bay_id }}</td>
                                <td>{{ s.user_id }}</td>
                                <td>{{ s.club_id }}</td>
                                <td>{{ "%.1f"|format(s.total_distance) if s.total_distance is not none else "" }}</td>
                                <td>{{ "%.1f"|format(s.carry) if s.carry is not none else "" }}</td>
                                <td>{{ "%.2f"|format(s.smash_factor) if s.smash_factor is not none else "" }}</td>
                                <td>{{ "%.2f"|format(s.ball_speed) if s.ball_speed is not none else "" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">ì•„ì§ ìƒ· ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <script>
        function clearSession(storeId, bayId) {
            if (confirm('ì„¸ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch('{{ url_for("clear_session") }}', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({store_id: storeId, bay_id: bayId})
                })
                .then(() => location.reload());
            }
        }
        
        function clearAllSessions() {
            if (confirm('ëª¨ë“  ì„¸ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch('{{ url_for("clear_all_sessions") }}', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                })
                .then(() => location.reload());
            }
        }
    </script>
</body>
</html>
